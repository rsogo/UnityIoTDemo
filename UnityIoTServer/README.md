# README

## 概要
このプログラムは、M5Stack Core2からのセンサーデータを受け取り、FastAPIを使ってAPIを公開するサーバーアプリケーションです。UnityアプリからAPIを呼び出すことで、センサーデータを取得することができます。

## 実行方法
以下の手順に従って、このプログラムを実行してください。

1. Pythonのバージョンを確認し、必要に応じてインストールしてください。本プログラムはPython 3.9で動作を確認しています。
2. このリポジトリをクローンしてください。
3. コマンドラインで、プログラムがあるディレクトリに移動してください。
4. `pip install -r requirements.txt`を実行して、必要なパッケージをインストールしてください。
5. `uvicorn sensor_api:app --host 0.0.0.0 --port 8000`を実行して、サーバーを起動してください。

## API
このプログラムは、以下のAPIを提供します。

### `POST /data`
センサーデータを受け取り、メモリ上に保持します。

#### リクエストボディ
```json
{
    "data": [
        {
            "sensor_id": 1,
            "value": 30.5
        },
        {
            "sensor_id": 2,
            "value": 20.1
        }
    ]
}
```

#### レスポンス
- ステータスコード: 200
- レスポンスボディ: なし

### `GET /data`
メモリ上に保持されているセンサーデータを取得します。

#### レスポンス
- ステータスコード: 200
- レスポンスボディ:
```json
{
    "data": [
        {
            "sensor_id": 1,
            "value": 30.5
        },
        {
            "sensor_id": 2,
            "value": 20.1
        }
    ]
}
```


### APIドキュメント
ウェブブラウザを開き、http://localhost:8000/docs にアクセスします。Swagger UIが表示され、APIドキュメントを見ることができます。

センサーデータを送信する場合は、別のターミナルを開いて、以下のcurlコマンドを実行します。

```
curl -X POST http://localhost:8000/sensor -H "Content-Type: application/json" -d '{"sensor_data": "xxx"}'
```